"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};jQuery(document).ready(function(){return MPSUM.init()});var $=jQuery,MPSUM={timer:null,delay:500,init:function(){this.__register_update_toggle_events(),this.__register_save_settings_event(),this.__register_bulk_actions_event(),this.__register_pagination_events(),this.__register_filter_link_events(),this.__register_logs_filter_event(),this.__register_excluded_user_event(),this.__register_force_updates_event(),this.__register_enable_logs_event(),this.__register_clear_logs_event(),this.__register_reset_options_event()},render:function(a){this.__render_filter_links(a.views),this.__render_rows(a.rows),this.__render_headers(a.headers),this.__render_pagination_top(a.pagination.top),this.__render_pagination_bottom(a.pagination.bottom),this.init(),this.__unblockUI()},send_command:function(a,b,c,d){this.__blockUI();var e={json_parse:!0,alert_on_error:!0,action:"eum_ajax",nonce:mpsum.eum_nonce,nonce_key:"eum_nonce",timeout:null,async:!0,type:"POST"};for(var f in"undefined"==typeof d&&(d={}),e)d.hasOwnProperty(f)||(d[f]=e[f]);var g={action:d.action,subaction:a,nonce:d.nonce,nonce_key:d.nonce_key};if(g[d.nonce_key]=d.nonce,"object"===("undefined"==typeof b?"undefined":_typeof(b)))for(var h in b)g[h]=b[h];else g.action_data=b;var i={type:d.type,url:ajaxurl,data:g,success:function(a,b){if(d.json_parse){var e;try{e=MPSUM.parse_json(a)}catch(b){return console.log(b),console.log(a),void(d.alert_on_error&&alert(mpsum.unexpected_response+" "+a))}"function"==typeof c&&c(e,b,a)}else"function"==typeof c&&c(a,b)},error:function(a,b,c){"function"==typeof d.error_callback?d.error_callback(a,b,c):(console.log("eum_send_command: error: "+b+"  ("+c+")"),console.log(a))},dataType:"text",async:d.async};null!=d.timeout&&(i.timeout=d.timeout),jQuery.ajax(i)},parse_json:function(a){try{var b=JSON.parse(a);return b}catch(b){console.log("EUM: Exception when trying to parse JSON (1) - will attempt to fix/re-parse"),console.log(a)}var c=a.indexOf("{"),d=a.lastIndexOf("}");if(-1<c&&-1<d){var e=a.slice(c,d+1);try{var f=JSON.parse(e);return console.log("EUM: JSON re-parse successful"),f}catch(a){throw console.log("EUM: Exception when trying to parse JSON (2)"),a}}throw"EUM: could not parse the JSON"},gather_settings:function(a){var b="";return a="undefined"==typeof a?"string":a,b="object"===a?$("input, select").serializeJSON({checkboxUncheckedValue:"0",useIntKeysAsArrayIndex:!0}):$("input, select").serialize(),b},__get_data:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c={},d=location.search.substring(1),e=$("ul.subsubsub li > a.current"),f=e.data("plugin_status"),g=e.data("theme_status");switch(a){case"pagination":c.paged=this.__query(b.search.substring(1),"paged"),c.plugin_status=f,c.theme_status=g;break;case"pagination_input":case"bulk":case"save_settings":c.paged=parseInt($("input[name=paged]").val())||"1",c.plugin_status=f,c.theme_status=g;break;case"filters":var h=b.href.split("?");c.plugin_status=this.__query(h[1],"plugin_status")||"all",c.theme_status=this.__query(h[1],"theme_status")||"all";}return c.m=$("#filter-by-date").val(),c.status=$("#filter-by-success").val(),c.action_type=$("#filter-by-action").val(),c.type=$("#filter-by-type").val(),c.data=this.gather_settings("string"),c.tab=this.__query(d,"tab")||"",c},__query:function(a,b){for(var c,d=a.split("&"),e=0;e<d.length;e++)if(c=d[e].split("="),b===c[0])return c[1];return!1},__blockUI:function(){$.blockUI({message:"<div style=\"margin: 8px; font-size:150%;\">"+mpsum.working+"</div>"})},__unblockUI:function(){$(".wrap .fade").delay(6e3).fadeOut(2e3),$("html, body").animate({scrollTop:$(".wrap").offset().top},1e3),$.unblockUI()},__register_update_toggle_events:function(){var a=this.__get_data();$(".eum-toggle-button").on("click",function(b){b.preventDefault();var c=$(b.currentTarget),d=c.closest(".toggle-wrapper").find("input"),e=c.closest(".toggle-wrapper"),f=e.closest(".eum-"+a.tab+"-name-actions").find(".eum-"+a.tab+"-automatic-wrapper");c.addClass("eum-active"),c.hasClass("eum-enabled")?(c.next().removeClass("eum-active"),d.prop("value","true"),e.hasClass("toggle-wrapper-"+a.tab)&&(f.find("input").prop("value",!1),f.find(".eum-disabled").addClass("eum-active"),f.find(".eum-enabled").removeClass("eum-active"),f.slideDown())):(e.hasClass("toggle-wrapper-"+a.tab)&&f.slideUp(),c.prev().removeClass("eum-active"),d.prop("value","false"),f.find("input").prop("value",!1)),$("#eum-save-settings-warning").fadeIn()})},__register_save_settings_event:function(){var a=this;$("#eum-save-settings").on("click",function(b){b.preventDefault(),b.stopImmediatePropagation();var c=a.__get_data("save_settings");a.send_command("save_"+c.tab+"_update_options",c,function(b){$(".subsubsub").replaceWith(b.views),a.__unblockUI(),a.init()}),$("#eum-save-settings-warning").fadeOut()})},__register_bulk_actions_event:function(){var a=this;$("#doaction, #doaction2").on("click",function(b){if(b.preventDefault(),b.stopImmediatePropagation(),0!==$("input:checked").length){var c=a.__get_data("bulk",b.currentTarget);a.send_command("bulk_action_"+c.tab+"_update_options",c,function(b){a.render(b),$("#bulk-action-selector-top, #bulk-action-selector-bottom").val("-1")})}})},__register_pagination_events:function(){var a=this;$(".tablenav-pages a").on("click",function(b){b.preventDefault();var c=a.__get_data("pagination",b.currentTarget);a.__get_tab_content_and_render(c)}),$("input[name=paged]").on("keyup",function(b){13===b.which&&b.preventDefault(),window.clearTimeout(a.timer),a.timer=window.setTimeout(function(){var c=a.__get_data("pagination_input",b.currentTarget);a.__get_tab_content_and_render(c)},a.delay)})},__register_filter_link_events:function(){var a=this;$(".subsubsub a").on("click",function(b){b.preventDefault(),b.stopImmediatePropagation(),$(".subsubsub a").removeClass("current"),$(b.currentTarget).addClass("current");var c=a.__get_data("filters",b.currentTarget);a.__get_tab_content_and_render(c)})},__register_logs_filter_event:function(){var a=this;$("#post-query-submit").on("click",function(b){b.preventDefault(),b.stopImmediatePropagation();var c=a.__get_data();a.__get_tab_content_and_render(c)}),$("#filter-by-date, #filter-by-success, #filter-by-action, #filter-by-type").on("change",function(b){b.preventDefault(),b.stopImmediatePropagation();var c=a.__get_data();a.__get_tab_content_and_render(c)})},__register_excluded_user_event:function(){var a=this;$("#save-excluded-users").on("click",function(b){b.preventDefault(),a.send_command("save_excluded_users",{data:a.gather_settings("string")},function(b){$("#result").append("<div class=\"updated\"><p>"+b+"</p></div>").delay(2e3).slideUp(2e3),a.__unblockUI()})})},__register_force_updates_event:function(){var a=this;$("#force-updates").on("click",function(b){b.preventDefault();var c=$("#footer-upgrade strong a").html();a.send_command("force_updates",{},function(b){a.__unblockUI(),!0===b.ran_immediately?(0<b.update_data.counts.total?a.__update_notifications(b.update_data):a.__remove_update_notifications(b.update_data),"undefined"!=typeof c&&$("#footer-upgrade strong").html(c.substr(4))):($("#result").append("<div class=\"updated\"><p>"+b.message+"</p></div>").delay(5e3).slideUp(2e3),setTimeout(function(){return location.reload()},6e4))})})},__remove_update_notifications:function(){$("#wp-admin-bar-updates").remove(),$(".update-nag").remove(),$(".update-plugins").remove()},__update_notifications:function(a){$(".update-nag").remove(),$("#wp-admin-bar-updates").html(a.admin_bar_link),$("#menu-dashboard ul li:nth-child(3) a").html(a.updates_link),$("#menu-appearance a div:nth-child(3)").html(a.themes_link),$("#menu-plugins a div:nth-child(3)").html(a.plugins_link)},__register_enable_logs_event:function(){var a=this;$("#enable-logs").on("click",function(b){b.preventDefault(),a.send_command("enable_logs",{},function(b){$("#result").append("<div class=\"updated\"><p>"+b+"</p></div>").delay(2e3).slideUp(2e3),a.__unblockUI()})})},__register_clear_logs_event:function(){var a=this;$("#clear-logs").on("click",function(b){b.preventDefault(),a.send_command("clear_logs",{},function(b){$("#result").append("<div class=\"updated\"><p>"+b+"</p></div>").delay(2e3).slideUp(2e3);var c=a.__get_data();a.__get_tab_content_and_render(c),a.__unblockUI()})})},__register_reset_options_event:function(){var a=this;$("#reset-options").on("click",function(b){b.preventDefault(),a.send_command("reset_options",{},function(b){$("#result").append("<div class=\"updated\"><p>"+b+"</p></div>").delay(2e3).slideUp(2e3),a.__unblockUI()})})},__render_filter_links:function(a){"undefined"!==a&&a.length&&$(".subsubsub").replaceWith(a)},__render_rows:function(a){"undefined"!==a&&a.length&&$("#the-list").html(a)},__render_headers:function(a){"undefined"!==a&&a.length&&$("thead tr, tfoot tr").html(a)},__render_pagination_top:function(a){"undefined"!==a&&a.length&&$(".tablenav.top .tablenav-pages").html($(a).html())},__render_pagination_bottom:function(a){"undefined"!==a&&a.length&&$(".tablenav.bottom .tablenav-pages").html($(a).html())},__get_tab_content_and_render:function(a){var b=this;this.send_command("update_"+a.tab+"_tab",a,function(a){b.render(a)})}};